#change

outer_level.append(inner_level, [0,1])

#to

outer_level.append(inner_level.to_gate(), [0,1])
